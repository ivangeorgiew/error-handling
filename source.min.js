"use strict";const getErrorHandling=function(r){const e=r=>"function"!=typeof r&&r===Object(r),n="undefined"!=typeof window&&"[object Window]"==={}.toString.call(window),o="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),t=e(console)&&"function"==typeof console.error?console.error:function(){},i="a part of the application",c=["error","unhandledrejection"],s=["uncaughtException","unhandledRejection","SIGTERM","SIGINT"],a="boolean"==typeof(r=e(r)?r:{}).isDevelopment?r.isDevelopment:!(!e(process)||!e(process.env))&&"production"!==process.env.NODE_ENV,f="function"==typeof r.devErrorLogger?function(...e){try{r.devErrorLogger.apply(this,e)}catch(r){a&&(t(" Issue with: parameter devErrorLogger\n",r),t.apply(this,e))}}:t,u="function"==typeof r.onError?function(...e){try{r.onError.apply(this,e)}catch(r){a&&f(" Issue with: parameter onError\n",r)}}:function(){},p=function(r){try{const e=function(r,e){return e instanceof Error?Object.getOwnPropertyNames(e).reduce((r,n)=>(r[n]=e[n],r),{stack:e.stack}):"function"==typeof e?"[function]":e};return JSON.stringify(r,e)}catch(r){return JSON.stringify("[object Cyclic]")}},l=function(r){const t="boolean"==typeof(r=e(r)?r:{}).descr&&r.descr,c="string"==typeof r.descr?r.descr:t?"unhandled error, plese reload the app!":i;try{const e=r.err instanceof Error?r.err:new Error("Unknown error"),i=Array.isArray(r.args)?r.args.map(r=>JSON.parse(p(r))):["[unknown]"],s=i.reduce((r,e,n)=>{const o=p(e);return 0===n?`${r} ${o}`:`${r} , ${o}`},"");a&&f(` Issue with: ${c}\n Function arguments: ${s}\n`,e);const l={description:c,arguments:i,date:(new Date).toUTCString(),error:e};let d=p(l);n&&(d=p({...l,localUrl:window.location.href,machineInfo:{browserInfo:window.navigator.userAgent,language:window.navigator.language,osType:window.navigator.platform}})),o&&(d=p({...l,localUrl:__filename,machineInfo:{cpuArch:process.arch,osType:process.platform,depVersions:process.versions}})),u({isUncaught:t,description:c,productionMsg:d})}catch(r){a&&f(" Issue with: error logger\n",r),u({isUncaught:t,description:c,productionMsg:p({description:c,error:r})})}},d=function(r,n,o,t=!1){try{if("function"!=typeof n)throw new Error("Data given was not a function");const i=function(e,n){if(l({descr:r,err:e,args:n}),"function"==typeof o)return d("catching errors for "+r,o).call(this,{descr:r,err:e,args:n})};return function(...c){try{t&&(c=c.map(e=>"function"==typeof e?d("argument of "+r,e,o):e))}catch(r){l({descr:"error handling function arguments",err:r,args:c})}try{const r=n.apply(this,c);return e(r)&&"function"==typeof r.catch?r.catch(r=>i.apply(this,[r,c])):r}catch(r){return i.apply(this,[r,c])}}}catch(r){return l({descr:"error handling functions",err:r}),"function"==typeof n?n:function(){}}},g=d("creating error handled data",(...r)=>{let[n,o,t]=r;if("string"!=typeof n&&(n=i,o=r[0],t=r[1]),Array.isArray(o))return o.map((r,e)=>g(`element ${e} of ${n}`,r,t));if("function"==typeof o||e(o)){const r=!0,e="function"==typeof o?d(n,o,t,r):{},i=Object.getOwnPropertyDescriptors(o);return Object.keys(i).forEach(n=>{if(!i[n].configurable)return;const c="function"==typeof o[n+"Catch"]?o[n+"Catch"]:t,s="function"==typeof o[n]?d("method "+n,o[n],c,r).bind(o):o[n];Object.defineProperty(e,n,Object.assign(i[n],i[n].hasOwnProperty("value")?{value:s}:null))}),e}return o},({args:[r,e]})=>"string"==typeof r?e:r),y=d("listening for unexpected errors",r=>{if(n){if(r instanceof Event){r.stopImmediatePropagation(),r.preventDefault();const{reason:e,error:n}=r,o=e instanceof Error?e:n instanceof Error?n:void 0;l({isUncaught:!0,err:o})}window.document.body.style["pointer-events"]="none"}if(o){let e=0;r instanceof Error&&(e=1,l({isUncaught:!0,err:r})),setTimeout(()=>{process.exit(e)},1e3).unref()}}),h=d("initializing listening for unexpected errors",()=>{n&&(c.forEach(r=>{"function"==typeof window.__errorListener__&&window.removeEventListener(r,window.__errorListener__,!0),window.addEventListener(r,y,!0)}),window.__errorListener__=y),o&&(s.forEach(r=>{"function"==typeof global.__errorListener__&&process.removeListener(r,global.__errorListener__),process.on(r,y)}),global.__errorListener__=y)}),w=d("initializing error handling for server",r=>{r=e(r)?r:{};const n=new Set;"function"==typeof r.on&&(r.removeAllListeners("connection"),r.on("connection",r=>{n.add(r),r.on("close",()=>{n.delete(r)})}));const t=d("handling server closing",e=>{"function"==typeof r.close&&r.close(),n.forEach(r=>{r.destroy()})});return o&&s.forEach(r=>{process.prependListener(r,t)}),r},({args:[r]})=>r);return h(),{isDevelopment:a,devErrorLogger:f,onError:u,isObject:e,isBrowser:n,isNodeJS:o,stringifyAll:p,createData:g,getHandledServer:w}};module.exports=getErrorHandling;