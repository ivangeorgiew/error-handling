"use strict";const getErrorHandling=function(r){const e=r=>"object"==typeof r&&!Array.isArray(r)&&null!==r,n="undefined"!=typeof window&&"[object Window]"==={}.toString.call(window),o="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),t=class extends Error{constructor(...r){super(...r),this.name="FriendlyError"}},i=e(console)&&"function"==typeof console.error?console.error:function(){},s="a part of the application",c=["error","unhandledrejection"],a=["uncaughtException","unhandledRejection","SIGTERM","SIGINT"],f="boolean"==typeof(r=e(r)?r:{}).isDevelopment?r.isDevelopment:!(!e(process)||!e(process.env))&&"production"!==process.env.NODE_ENV,u="function"==typeof r.devErrorLogger?function(...e){try{r.devErrorLogger.apply(this,e)}catch(r){f&&(i(" Issue with: parameter devErrorLogger\n",r),i.apply(this,e))}}:i,p="function"==typeof r.notify?function(...e){try{r.notify.apply(this,e)}catch(r){f&&u(" Issue with: parameter notify\n",r)}}:function(){},l=function(r){try{const e=function(r,e){return e instanceof Error?Object.getOwnPropertyNames(e).reduce((r,n)=>(r[n]=e[n],r),{stack:e.stack}):"function"==typeof e?"[function]":e};return JSON.stringify(r,e)}catch(r){return JSON.stringify("[object Cyclic]")}},g=function(r){try{const i="boolean"==typeof(r=e(r)?r:{}).isUncaught&&r.isUncaught,c="string"==typeof r.descr?r.descr:i?"unhandled error":s,a=r.error instanceof Error?r.error:i?new Error("Uncaught error"):new Error("Unknown error"),g=Array.isArray(r.args)?r.args.map(r=>JSON.parse(l(r))):["[no arguments]"],d=g.reduce((r,e,n)=>{const o=l(e);return 0===n?`${r} ${o}`:`${r} , ${o}`},"");f&&u(` Issue with: ${c}\n Function arguments: ${d}\n`,a);const y={description:c,arguments:g,date:(new Date).toUTCString(),error:a},h=a instanceof t,w=h?a.message:"Issue with: "+c;let m=l(y);n&&(m=l({...y,localUrl:window.location.href,machineInfo:{browserInfo:window.navigator.userAgent,language:window.navigator.language,osType:window.navigator.platform}})),o&&(m=l({...y,localUrl:__filename,machineInfo:{cpuArch:process.arch,osType:process.platform,depVersions:process.versions}})),p({isUncaught:i,isFriendly:h,userMsg:w,productionMsg:m})}catch(r){f&&u(" Issue with: error logger\n",r)}},d=function(r,n,o,t=!1){try{if("function"!=typeof n)throw new Error("Data given was not a function");const i=function(e,n){if(g({descr:r,error:e,args:n}),"function"==typeof o)return d("catching errors for "+r,o).call(this,{descr:r,error:e,args:n})};return function(...s){try{t&&(s=s.map(e=>"function"==typeof e?d("argument of "+r,e,o):e))}catch(r){g({descr:"error handling function arguments",error:r,args:s})}try{const r=n.apply(this,s);return e(r)&&"function"==typeof r.catch?r.catch(r=>i.apply(this,[r,s])):r}catch(r){return i.apply(this,[r,s])}}}catch(r){return g({descr:"error handling functions",error:r}),"function"==typeof n?n:function(){}}},y=d("creating error handled data",(...r)=>{let[n,o,t]=r;if("string"!=typeof n&&(n=s,o=r[0],t=r[1]),Array.isArray(o))return o.map((r,e)=>y(`element ${e} of ${n}`,r,t));if("function"==typeof o||e(o)){const r=!0,e="function"==typeof o?d(n,o,t,r):{},i=Object.getOwnPropertyDescriptors(o);return Object.keys(i).forEach(s=>{if(!i[s].configurable)return;const c="function"==typeof o[s+"Catch"]?o[s+"Catch"]:t,a="function"==typeof o[s]?d(`method ${s} of ${n}`,o[s],c,r).bind(o):o[s];Object.defineProperty(e,s,Object.assign(i[s],i[s].hasOwnProperty("value")?{value:a}:null))}),e}return o},({args:[r,e]})=>"string"==typeof r?e:r),h=d("listening for unexpected errors",r=>{if(n){if(r instanceof Event){r.stopImmediatePropagation(),r.preventDefault();const e=r.reason instanceof Error?r.reason:r.error instanceof Error?r.error:void 0;g({isUncaught:!0,error:e})}window.document.body.style["pointer-events"]="none"}if(o){let e=0;r instanceof Error&&(e=1,g({isUncaught:!0,error:r})),setTimeout(()=>{process.exit(e)},1e3).unref()}}),w=d("initializing listening for unexpected errors",()=>{n&&(c.forEach(r=>{"function"==typeof window._tp_errorListener_&&window.removeEventListener(r,window._tp_errorListener_,!0),window.addEventListener(r,h,!0)}),window._tp_errorListener_=h),o&&(a.forEach(r=>{"function"==typeof global._tp_errorListener_&&process.removeListener(r,global._tp_errorListener_),process.on(r,h)}),global._tp_errorListener_=h)}),m=d("initializing error handling for server",r=>{r=e(r)?r:{on:()=>{},close:()=>{}};const n=new Set,t=d("handling server closing",()=>{r.close(),n.forEach(r=>{r.destroy()})});return o&&(r.on("connection",r=>{n.add(r),r.on("close",()=>{n.delete(r)})}),a.forEach(r=>{process.prependListener(r,t)})),r},({args:[r]})=>r);return w(),{isDevelopment:f,devErrorLogger:u,notify:p,isObject:e,isBrowser:n,isNodeJS:o,FriendlyError:t,stringifyAll:l,createData:y,getHandledServer:m}};module.exports=getErrorHandling;