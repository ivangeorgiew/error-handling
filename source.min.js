"use strict";const getErrorHandling=function(r){const e=r=>"object"==typeof r&&!Array.isArray(r)&&null!==r,n="undefined"!=typeof window&&"[object Window]"==={}.toString.call(window),o="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),t=e(console)&&"function"==typeof console.error?console.error:function(){},i="a part of the application",s=["error","unhandledrejection"],c=["uncaughtException","unhandledRejection","SIGTERM","SIGINT"],a="boolean"==typeof(r=e(r)?r:{}).isDevelopment?r.isDevelopment:!(!e(process)||!e(process.env))&&"production"!==process.env.NODE_ENV,f="function"==typeof r.devErrorLogger?function(...e){try{r.devErrorLogger.apply(this,e)}catch(r){a&&(t(" Issue with: parameter devErrorLogger\n",r),t.apply(this,e))}}:t,u="function"==typeof r.notify?function(...e){try{r.notify.apply(this,e)}catch(r){a&&f(" Issue with: parameter notify\n",r)}}:function(){},p=function(r){try{const e=function(r,e){return e instanceof Error?Object.getOwnPropertyNames(e).reduce((r,n)=>(r[n]=e[n],r),{stack:e.stack}):"function"==typeof e?"[function]":e};return JSON.stringify(r,e)}catch(r){return JSON.stringify("[object Cyclic]")}},l=function(r){try{const t="boolean"==typeof(r=e(r)?r:{}).isUncaught&&r.isUncaught,s="string"==typeof r.descr?r.descr:t?"unhandled error":i,c=r.error instanceof Error?r.error:new Error("Unknown error"),l=Array.isArray(r.args)?r.args.map(r=>JSON.parse(p(r))):["[unknown]"],g=l.reduce((r,e,n)=>{const o=p(e);return 0===n?`${r} ${o}`:`${r} , ${o}`},"");a&&f(` Issue with: ${s}\n Function arguments: ${g}\n`,c);const d={description:s,arguments:l,date:(new Date).toUTCString(),error:c},y="Issue with: "+s;let h=p(d);n&&(h=p({...d,localUrl:window.location.href,machineInfo:{browserInfo:window.navigator.userAgent,language:window.navigator.language,osType:window.navigator.platform}})),o&&(h=p({...d,localUrl:__filename,machineInfo:{cpuArch:process.arch,osType:process.platform,depVersions:process.versions}})),u({isDevelopment:a,isUncaught:t,userMsg:y,productionMsg:h})}catch(r){a&&f(" Issue with: error logger\n",r)}},g=function(r,n,o,t=!1){try{if("function"!=typeof n)throw new Error("Data given was not a function");const i=function(e,n){if(l({descr:r,error:e,args:n}),"function"==typeof o)return g("catching errors for "+r,o).call(this,{descr:r,error:e,args:n})};return function(...s){try{t&&(s=s.map(e=>"function"==typeof e?g("argument of "+r,e,o):e))}catch(r){l({descr:"error handling function arguments",error:r,args:s})}try{const r=n.apply(this,s);return e(r)&&"function"==typeof r.catch?r.catch(r=>i.apply(this,[r,s])):r}catch(r){return i.apply(this,[r,s])}}}catch(r){return l({descr:"error handling functions",error:r}),"function"==typeof n?n:function(){}}},d=g("creating error handled data",(...r)=>{let[n,o,t]=r;if("string"!=typeof n&&(n=i,o=r[0],t=r[1]),Array.isArray(o))return o.map((r,e)=>d(`element ${e} of ${n}`,r,t));if("function"==typeof o||e(o)){const r=!0,e="function"==typeof o?g(n,o,t,r):{},i=Object.getOwnPropertyDescriptors(o);return Object.keys(i).forEach(s=>{if(!i[s].configurable)return;const c="function"==typeof o[s+"Catch"]?o[s+"Catch"]:t,a="function"==typeof o[s]?g(`method ${s} of ${n}`,o[s],c,r).bind(o):o[s];Object.defineProperty(e,s,Object.assign(i[s],i[s].hasOwnProperty("value")?{value:a}:null))}),e}return o},({args:[r,e]})=>"string"==typeof r?e:r),y=g("listening for unexpected errors",r=>{if(n){if(r instanceof Event){r.stopImmediatePropagation(),r.preventDefault();const e=r.reason instanceof Error?r.reason:r.error instanceof Error?r.error:void 0;l({isUncaught:!0,error:e})}window.document.body.style["pointer-events"]="none"}if(o){let e=0;r instanceof Error&&(e=1,l({isUncaught:!0,error:r})),setTimeout(()=>{process.exit(e)},1e3).unref()}}),h=g("initializing listening for unexpected errors",()=>{n&&(s.forEach(r=>{"function"==typeof window._tp_errorListener_&&window.removeEventListener(r,window._tp_errorListener_,!0),window.addEventListener(r,y,!0)}),window._tp_errorListener_=y),o&&(c.forEach(r=>{"function"==typeof global._tp_errorListener_&&process.removeListener(r,global._tp_errorListener_),process.on(r,y)}),global._tp_errorListener_=y)}),w=g("initializing error handling for server",r=>{r=e(r)?r:{on:()=>{},close:()=>{}};const n=new Set,t=g("handling server closing",()=>{r.close(),n.forEach(r=>{r.destroy()})});return o&&(r.on("connection",r=>{n.add(r),r.on("close",()=>{n.delete(r)})}),c.forEach(r=>{process.prependListener(r,t)})),r},({args:[r]})=>r);return h(),{isDevelopment:a,devErrorLogger:f,notify:u,isObject:e,isBrowser:n,isNodeJS:o,stringifyAll:p,createData:d,getHandledServer:w}};module.exports=getErrorHandling;